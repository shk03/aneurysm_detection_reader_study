<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Study Consent Form</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.6;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        color: #1e293b;
        min-height: 100vh;
      }

      .container {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(20px);
        border-radius: 16px;
        padding: 40px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.5);
        margin-bottom: 20px;
      }

      h1 {
        color: #1e293b;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.2em;
        font-weight: 600;
      }

      h2 {
        color: #374151;
        margin-top: 30px;
        margin-bottom: 15px;
        font-size: 1.3em;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 8px;
      }

      .consent-content {
        max-height: 400px;
        overflow-y: auto;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        background: white;
        font-size: 0.95em;
      }

      .consent-content::-webkit-scrollbar {
        width: 8px;
      }

      .consent-content::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 4px;
      }

      .consent-content::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }

      .consent-content::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      .checkbox-group {
        background: #f8fafc;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
      }

      .checkbox-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
        font-size: 0.95em;
      }

      .checkbox-item:last-child {
        margin-bottom: 0;
      }

      .checkbox-item input[type="checkbox"] {
        margin-right: 12px;
        margin-top: 4px;
        transform: scale(1.2);
        cursor: pointer;
      }

      .checkbox-item label {
        cursor: pointer;
        flex: 1;
      }

      .signature-section {
        background: #f8fafc;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 25px;
        margin: 25px 0;
      }

      .signature-input {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .input-group {
        display: flex;
        flex-direction: column;
      }

      .input-group label {
        font-weight: 600;
        margin-bottom: 8px;
        color: #374151;
      }

      .input-group input {
        padding: 12px;
        border: 2px solid #d1d5db;
        border-radius: 6px;
        font-size: 1em;
        transition: border-color 0.3s;
      }

      .input-group input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .digital-signature {
        margin-top: 20px;
        padding: 15px;
        background: white;
        border: 2px dashed #d1d5db;
        border-radius: 6px;
        text-align: center;
        color: #6b7280;
        font-style: italic;
      }

      .buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: #3b82f6;
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: #2563eb;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
      }

      .btn-primary:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn-secondary {
        background: #6b7280;
        color: white;
      }

      .btn-secondary:hover {
        background: #4b5563;
      }

      .error-message {
        color: #dc2626;
        background: #fef2f2;
        border: 1px solid #fecaca;
        border-radius: 6px;
        padding: 12px;
        margin: 15px 0;
        display: none;
      }

      .success-message {
        color: #059669;
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        border-radius: 6px;
        padding: 15px;
        margin: 15px 0;
        display: none;
        text-align: center;
      }

      @media (max-width: 600px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 20px;
        }

        .signature-input {
          grid-template-columns: 1fr;
        }

        .buttons {
          flex-direction: column;
          align-items: center;
        }

        .btn {
          width: 100%;
          max-width: 300px;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>📋 Informed Consent for Research Participation</h1>

      <div class="consent-content" id="consentContent">
        <h2>Study Title: [Your Study Title Here]</h2>

        <h2>Purpose of the Study</h2>
        <p>
          You are being invited to participate in a research study conducted by
          [Principal Investigator Name] at [Institution Name]. The purpose of
          this study is to [briefly describe the study purpose].
        </p>

        <h2>What Will Happen</h2>
        <p>If you agree to participate in this study, you will be asked to:</p>
        <ul>
          <li>[Describe what participants will do]</li>
          <li>[List specific tasks or procedures]</li>
          <li>
            [Mention duration - e.g., "This will take approximately 15-20
            minutes"]
          </li>
        </ul>

        <h2>Risks and Benefits</h2>
        <p>
          <strong>Risks:</strong> The risks associated with this study are
          minimal. [Describe any potential risks or state "There are no known
          risks beyond those of everyday life."]
        </p>
        <p>
          <strong>Benefits:</strong> While there may be no direct benefit to
          you, this research may help [describe potential benefits to
          science/society].
        </p>

        <h2>Confidentiality</h2>
        <p>
          Your privacy and confidentiality will be protected. All data will be:
        </p>
        <ul>
          <li>
            Stored securely and accessed only by authorized research personnel
          </li>
          <li>De-identified and anonymized for analysis</li>
          <li>Retained for [time period] and then securely destroyed</li>
        </ul>

        <h2>Voluntary Participation</h2>
        <p>Your participation in this study is entirely voluntary. You may:</p>
        <ul>
          <li>Decline to participate without any consequences</li>
          <li>Withdraw from the study at any time</li>
          <li>Skip any questions you don't wish to answer</li>
        </ul>

        <h2>Contact Information</h2>
        <p>If you have questions about this study, please contact:</p>
        <ul>
          <li><strong>Principal Investigator:</strong> [Name, Email, Phone]</li>
          <li><strong>Institution:</strong> [Institution Name]</li>
          <li>
            <strong>IRB Contact:</strong> [If applicable - IRB contact
            information]
          </li>
        </ul>

        <h2>Compensation</h2>
        <p>
          [Describe any compensation, or state "There is no compensation for
          participation in this study."]
        </p>
      </div>

      <div class="checkbox-group">
        <div class="checkbox-item">
          <input type="checkbox" id="readConsent" required />
          <label for="readConsent"
            >I have read and understood the above information about this
            research study.</label
          >
        </div>

        <div class="checkbox-item">
          <input type="checkbox" id="voluntaryParticipation" required />
          <label for="voluntaryParticipation"
            >I understand that my participation is voluntary and that I may
            withdraw at any time.</label
          >
        </div>

        <div class="checkbox-item">
          <input type="checkbox" id="ageConfirmation" required />
          <label for="ageConfirmation"
            >I confirm that I am at least 18 years old.</label
          >
        </div>

        <div class="checkbox-item">
          <input type="checkbox" id="agreeParticipate" required />
          <label for="agreeParticipate"
            ><strong
              >I agree to participate in this research study.</strong
            ></label
          >
        </div>
      </div>

      <div class="signature-section">
        <h2>Digital Signature</h2>
        <div class="signature-input">
          <div class="input-group">
            <label for="participantName">Full Name *</label>
            <input
              type="text"
              id="participantName"
              required
              placeholder="Enter your full name"
            />
          </div>

          <div class="input-group">
            <label for="participantEmail">Email Address *</label>
            <input
              type="email"
              id="participantEmail"
              required
              placeholder="Enter your email"
            />
          </div>
        </div>

        <div class="digital-signature" id="digitalSignature">
          Digital signature will appear here when form is completed
        </div>
      </div>

      <div class="error-message" id="errorMessage">
        Please complete all required fields and check all boxes to proceed.
      </div>

      <div class="success-message" id="successMessage">
        ✅ Consent recorded successfully! You will now be redirected to the
        study.
      </div>

      <div class="buttons">
        <button class="btn btn-secondary" onclick="declineParticipation()">
          ❌ I Do Not Consent
        </button>
        <button
          class="btn btn-primary"
          id="consentButton"
          onclick="giveConsent()"
          disabled
        >
          ✅ I Give My Consent
        </button>
      </div>
    </div>

    <script>
      // ============================================
      // CONFIGURE YOUR URLS HERE
      // ============================================
      const studyUrl =
        "https://https://shk03.github.io/aneurysm_detection_reader_study/"; // Your randomizer URL
      const googleSheetsUrl =
        "https://script.google.com/macros/s/AKfycbzxEQMnnXERy-59MmPeGBz-W8-d1lnuRTB-rfct5-fEbZjPL8H9JB170VNY4KYozGEsCw/exec"; // Replace with your Apps Script web app URL

      // ============================================
      // DO NOT MODIFY BELOW THIS LINE
      // ============================================

      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      const nameInput = document.getElementById("participantName");
      const emailInput = document.getElementById("participantEmail");
      const consentButton = document.getElementById("consentButton");
      const errorMessage = document.getElementById("errorMessage");
      const successMessage = document.getElementById("successMessage");
      const digitalSignature = document.getElementById("digitalSignature");

      // Check if all requirements are met
      function checkFormCompletion() {
        const allChecked = Array.from(checkboxes).every(
          (checkbox) => checkbox.checked
        );
        const nameCompleted = nameInput.value.trim().length > 0;
        const emailCompleted =
          emailInput.value.trim().length > 0 && emailInput.validity.valid;

        const formComplete = allChecked && nameCompleted && emailCompleted;
        consentButton.disabled = !formComplete;

        // Update digital signature preview
        if (nameCompleted && emailCompleted) {
          const now = new Date();
          digitalSignature.innerHTML = `
                    <strong>${nameInput.value.trim()}</strong><br>
                    ${emailInput.value.trim()}<br>
                    ${now.toLocaleDateString()} at ${now.toLocaleTimeString()}
                `;
          digitalSignature.style.color = "#374151";
          digitalSignature.style.fontStyle = "normal";
        } else {
          digitalSignature.innerHTML =
            "Digital signature will appear here when form is completed";
          digitalSignature.style.color = "#6b7280";
          digitalSignature.style.fontStyle = "italic";
        }

        // Hide error message if form becomes complete
        if (formComplete) {
          errorMessage.style.display = "none";
        }
      }

      // Add event listeners
      checkboxes.forEach((checkbox) => {
        checkbox.addEventListener("change", checkFormCompletion);
      });

      nameInput.addEventListener("input", checkFormCompletion);
      emailInput.addEventListener("input", checkFormCompletion);

      function giveConsent() {
        // Final validation
        if (consentButton.disabled) {
          errorMessage.style.display = "block";
          errorMessage.scrollIntoView({ behavior: "smooth" });
          return;
        }

        // Record consent data
        const consentData = {
          name: nameInput.value.trim(),
          email: emailInput.value.trim(),
          timestamp: new Date().toISOString(),
          ipAddress: "Will be recorded server-side if needed",
          userAgent: navigator.userAgent,
          studyAssignment: "Will be determined by randomizer",
        };

        // Show processing state
        consentButton.disabled = true;
        consentButton.textContent = "Recording Consent...";

        // Send to Google Sheets
        if (
          googleSheetsUrl &&
          googleSheetsUrl !== "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE"
        ) {
          fetch(googleSheetsUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(consentData),
          })
            .then((response) => response.json())
            .then((result) => {
              if (result.success) {
                console.log("Consent recorded successfully:", consentData);
                showSuccessAndRedirect();
              } else {
                console.error("Error recording consent:", result.error);
                // Still proceed to study even if recording fails
                showSuccessAndRedirect();
              }
            })
            .catch((error) => {
              console.error("Network error:", error);
              // Still proceed to study even if recording fails
              showSuccessAndRedirect();
            });
        } else {
          console.log(
            "Google Sheets URL not configured, consent data:",
            consentData
          );
          alert("Please configure the Google Sheets URL in the HTML code!");
          consentButton.disabled = false;
          consentButton.textContent = "✅ I Give My Consent";
          return;
        }
      }

      function showSuccessAndRedirect() {
        // Show success message
        successMessage.style.display = "block";
        consentButton.textContent = "Consent Recorded ✅";

        // Redirect to study after brief delay
        setTimeout(() => {
          if (
            studyUrl &&
            studyUrl !== "https://yourusername.github.io/study-randomizer/"
          ) {
            window.location.href = studyUrl;
          } else {
            alert("Please configure the study URL in the HTML code!");
          }
        }, 2000);
      }

      function declineParticipation() {
        if (
          confirm("Are you sure you do not wish to participate in this study?")
        ) {
          alert("Thank you for your time. You may now close this page.");
          // Optionally redirect to a "thank you for considering" page
          // window.location.href = 'https://yoursite.com/thank-you';
        }
      }

      // Initialize form state
      checkFormCompletion();
    </script>
  </body>
</html>
