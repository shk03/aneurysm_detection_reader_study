<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aneurysm Detection Reader Study</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.6;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        color: #1e293b;
        min-height: 100vh;
      }

      .container {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(20px);
        border-radius: 16px;
        padding: 40px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.5);
      }

      h1 {
        color: #1e293b;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.5em;
        font-weight: 600;
      }

      .study-intro {
        text-align: center;
        margin-bottom: 40px;
        padding: 20px;
        background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
        border-radius: 12px;
        border-left: 4px solid #0ea5e9;
      }

      .study-intro h2 {
        color: #0c4a6e;
        margin-bottom: 15px;
      }

      .study-intro p {
        color: #0369a1;
        font-size: 1.1em;
        margin-bottom: 10px;
      }

      /* Collapsible Sections */
      .collapsible-section {
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        margin-bottom: 20px;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .collapsible-section:hover {
        border-color: #3b82f6;
      }

      .section-header {
        background: #f8fafc;
        padding: 20px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s ease;
      }

      .section-header:hover {
        background: #f1f5f9;
      }

      .section-header h3 {
        margin: 0;
        color: #1e293b;
        font-size: 1.2em;
      }

      .section-header .toggle-icon {
        font-size: 1.2em;
        color: #6b7280;
        transition: transform 0.3s ease;
      }

      .section-header.active .toggle-icon {
        transform: rotate(180deg);
      }

      .section-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease, padding 0.3s ease;
        padding: 0 20px;
      }

      .section-content.active {
        max-height: 1000px;
        padding: 20px;
      }

      .section-content h4 {
        color: #374151;
        margin-top: 20px;
        margin-bottom: 10px;
      }

      .section-content ul {
        margin: 10px 0;
        padding-left: 20px;
      }

      .section-content li {
        margin-bottom: 8px;
      }

      /* Consent Section */
      .consent-section {
        background: #fef3c7;
        border: 2px solid #f59e0b;
        border-radius: 12px;
        padding: 25px;
        margin: 30px 0;
      }

      .consent-section h3 {
        color: #92400e;
        margin-bottom: 20px;
        text-align: center;
      }

      .checkbox-group {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .checkbox-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
        font-size: 0.95em;
      }

      .checkbox-item:last-child {
        margin-bottom: 0;
      }

      .checkbox-item input[type="checkbox"] {
        margin-right: 12px;
        margin-top: 4px;
        transform: scale(1.2);
        cursor: pointer;
      }

      .checkbox-item label {
        cursor: pointer;
        flex: 1;
      }

      .signature-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
      }

      .signature-input {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .input-group {
        display: flex;
        flex-direction: column;
      }

      .input-group label {
        font-weight: 600;
        margin-bottom: 8px;
        color: #374151;
      }

      .input-group input {
        padding: 12px;
        border: 2px solid #d1d5db;
        border-radius: 6px;
        font-size: 1em;
        transition: border-color 0.3s;
      }

      .input-group input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .digital-signature {
        margin-top: 15px;
        padding: 15px;
        background: #f8fafc;
        border: 2px dashed #d1d5db;
        border-radius: 6px;
        text-align: center;
        color: #6b7280;
        font-style: italic;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Study Participation Section */
      .study-section {
        background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
        border: 2px solid #10b981;
        border-radius: 12px;
        padding: 30px;
        margin-top: 30px;
        text-align: center;
        opacity: 0.5;
        transition: all 0.3s ease;
      }

      .study-section.enabled {
        opacity: 1;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.15);
      }

      .study-section h3 {
        color: #065f46;
        margin-bottom: 15px;
      }

      .study-section p {
        color: #047857;
        margin-bottom: 25px;
      }

      /* Buttons */
      .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 50px;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin: 5px;
      }

      .btn-primary {
        background: #3b82f6;
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: #2563eb;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
      }

      .btn-primary:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn-success {
        background: #10b981;
        color: white;
      }

      .btn-success:hover:not(:disabled) {
        background: #059669;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
      }

      .btn-success:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .error-message {
        color: #dc2626;
        background: #fef2f2;
        border: 1px solid #fecaca;
        border-radius: 6px;
        padding: 12px;
        margin: 15px 0;
        display: none;
      }

      .success-message {
        color: #059669;
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        border-radius: 6px;
        padding: 15px;
        margin: 15px 0;
        display: none;
        text-align: center;
      }

      /* Responsive Design */
      @media (max-width: 600px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 20px;
        }

        .signature-input {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 2em;
        }
      }

      /* Progress indicator */
      .progress-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 20px 0;
        gap: 10px;
      }

      .progress-step {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #6b7280;
        transition: all 0.3s ease;
      }

      .progress-step.active {
        background: #3b82f6;
        color: white;
      }

      .progress-step.completed {
        background: #10b981;
        color: white;
      }

      .progress-line {
        width: 50px;
        height: 2px;
        background: #e5e7eb;
        transition: all 0.3s ease;
      }

      .progress-line.completed {
        background: #10b981;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🧠 Aneurysm Detection Reader Study</h1>

      <div class="study-intro">
        <h2>Medical Image Analysis Research</h2>
        <p>
          <strong>Welcome!</strong> You are invited to participate in a research
          study examining the detection of aneurysms in medical images.
        </p>
        <p><strong>Estimated time:</strong> 15-20 minutes</p>
      </div>

      <div class="progress-indicator">
        <div class="progress-step active" id="step1">1</div>
        <div class="progress-line" id="line1"></div>
        <div class="progress-step" id="step2">2</div>
        <div class="progress-line" id="line2"></div>
        <div class="progress-step" id="step3">3</div>
      </div>

      <!-- Collapsible Information Sections -->
      <div class="collapsible-section">
        <div class="section-header" onclick="toggleSection(this)">
          <h3>📋 Study Purpose and Procedures</h3>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="section-content">
          <h4>Purpose of the Study</h4>
          <p>
            You are being invited to participate in a research study conducted
            by [Principal Investigator Name] at [Institution Name]. The purpose
            of this study is to evaluate the accuracy of aneurysm detection in
            medical images by healthcare professionals and to improve diagnostic
            tools.
          </p>

          <h4>What Will Happen</h4>
          <p>
            If you agree to participate in this study, you will be asked to:
          </p>
          <ul>
            <li>Review a series of medical images (CT scans or MRI images)</li>
            <li>Identify potential aneurysms in the provided images</li>
            <li>Rate your confidence in each diagnosis</li>
            <li>Complete a brief questionnaire about your experience</li>
            <li>This will take approximately 15-20 minutes to complete</li>
          </ul>
        </div>
      </div>

      <div class="collapsible-section">
        <div class="section-header" onclick="toggleSection(this)">
          <h3>⚖️ Risks and Benefits</h3>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="section-content">
          <h4>Risks</h4>
          <p>
            The risks associated with this study are minimal. There are no known
            risks beyond those of everyday life. You may experience mild eye
            strain from viewing medical images on a computer screen.
          </p>

          <h4>Benefits</h4>
          <p>
            While there may be no direct benefit to you, this research may help:
          </p>
          <ul>
            <li>Improve diagnostic accuracy for aneurysm detection</li>
            <li>Develop better training tools for medical professionals</li>
            <li>Enhance computer-aided diagnostic systems</li>
            <li>Ultimately improve patient care and outcomes</li>
          </ul>
        </div>
      </div>

      <div class="collapsible-section">
        <div class="section-header" onclick="toggleSection(this)">
          <h3>🔒 Confidentiality and Privacy</h3>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="section-content">
          <h4>Data Protection</h4>
          <p>
            Your privacy and confidentiality will be strictly protected. All
            data will be:
          </p>
          <ul>
            <li>De-identified and anonymized for analysis</li>
            <li>Stored securely on encrypted, password-protected systems</li>
            <li>Accessed only by authorized research personnel</li>
            <li>
              Retained for 7 years as required by research regulations, then
              securely destroyed
            </li>
          </ul>

          <h4>Data Use</h4>
          <p>Your anonymized data may be used for:</p>
          <ul>
            <li>Statistical analysis for this research study</li>
            <li>Future related research studies (with proper approvals)</li>
            <li>
              Publication in academic journals (no personal information will be
              included)
            </li>
          </ul>
        </div>
      </div>

      <div class="collapsible-section">
        <div class="section-header" onclick="toggleSection(this)">
          <h3>🤝 Rights and Participation</h3>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="section-content">
          <h4>Voluntary Participation</h4>
          <p>
            Your participation in this study is entirely voluntary. You may:
          </p>
          <ul>
            <li>Decline to participate without any consequences</li>
            <li>Withdraw from the study at any time without penalty</li>
            <li>Skip any questions you don't wish to answer</li>
            <li>Request that your data be removed from the study</li>
          </ul>

          <h4>Compensation</h4>
          <p>
            There is no monetary compensation for participation in this study.
            However, you will contribute to important medical research that may
            benefit future patients.
          </p>
        </div>
      </div>

      <div class="collapsible-section">
        <div class="section-header" onclick="toggleSection(this)">
          <h3>📞 Contact Information</h3>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="section-content">
          <h4>Research Team</h4>
          <p>If you have questions about this study, please contact:</p>
          <ul>
            <li>
              <strong>Principal Investigator:</strong> [Name] - [Email] -
              [Phone]
            </li>
            <li>
              <strong>Research Coordinator:</strong> [Name] - [Email] - [Phone]
            </li>
            <li>
              <strong>Institution:</strong> [Institution Name and Address]
            </li>
          </ul>

          <h4>Research Ethics</h4>
          <p>
            This study has been reviewed and approved by the [Institution]
            Institutional Review Board (IRB). If you have concerns about your
            rights as a research participant, contact:
          </p>
          <ul>
            <li><strong>IRB Office:</strong> [Email] - [Phone]</li>
          </ul>
        </div>
      </div>

      <!-- Consent Section -->
      <div class="consent-section">
        <h3>✍️ Informed Consent and Digital Signature</h3>

        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" id="readConsent" required />
            <label for="readConsent"
              >I have read and understood all the information provided about
              this research study, including the purpose, procedures, risks, and
              benefits.</label
            >
          </div>

          <div class="checkbox-item">
            <input type="checkbox" id="voluntaryParticipation" required />
            <label for="voluntaryParticipation"
              >I understand that my participation is voluntary and that I may
              withdraw from the study at any time without penalty.</label
            >
          </div>

          <div class="checkbox-item">
            <input type="checkbox" id="dataUsage" required />
            <label for="dataUsage"
              >I understand how my data will be collected, stored, and used for
              research purposes, and I consent to this use.</label
            >
          </div>

          <div class="checkbox-item">
            <input type="checkbox" id="ageConfirmation" required />
            <label for="ageConfirmation"
              >I confirm that I am at least 18 years old and legally able to
              provide consent.</label
            >
          </div>

          <div class="checkbox-item">
            <input type="checkbox" id="agreeParticipate" required />
            <label for="agreeParticipate"
              ><strong
                >I voluntarily agree to participate in this research
                study.</strong
              ></label
            >
          </div>
        </div>

        <div class="signature-section">
          <h4>Digital Signature</h4>
          <div class="signature-input">
            <div class="input-group">
              <label for="participantName">Full Name *</label>
              <input
                type="text"
                id="participantName"
                required
                placeholder="Enter your full legal name"
              />
            </div>

            <div class="input-group">
              <label for="participantEmail">Email Address *</label>
              <input
                type="email"
                id="participantEmail"
                required
                placeholder="Enter your email address"
              />
            </div>
          </div>

          <div class="digital-signature" id="digitalSignature">
            Digital signature will appear here when form is completed
          </div>
        </div>

        <div class="error-message" id="errorMessage">
          Please complete all required fields and check all boxes to proceed.
        </div>

        <div style="text-align: center; margin-top: 20px">
          <button
            class="btn btn-primary"
            id="consentButton"
            onclick="recordConsent()"
            disabled
          >
            ✅ I Give My Informed Consent
          </button>
        </div>
      </div>

      <!-- Study Participation Section -->
      <div class="study-section" id="studySection">
        <h3>🎯 Ready to Begin Study</h3>
        <p>
          Thank you for providing your informed consent. You will now be
          randomly assigned to one of two study conditions and directed to begin
          the image analysis task.
        </p>

        <div class="success-message" id="successMessage">
          ✅ Consent recorded successfully! You can now proceed to the study.
        </div>

        <button
          class="btn btn-success"
          id="participateBtn"
          onclick="randomRedirect()"
          disabled
        >
          🚀 Begin Study Participation
        </button>
      </div>
    </div>

    <script>
      // ============================================
      // CONFIGURE YOUR URLS HERE
      // ============================================
      const formA = "https://google.com"; // Replace with your first survey URL
      const formB = "https://bing.com"; // Replace with your second survey URL
      const googleSheetsUrl =
        "https://script.google.com/macros/s/AKfycbzxEQMnnXERy-59MmPeGBz-W8-d1lnuRTB-rfct5-fEbZjPL8H9JB170VNY4KYozGEsCw/exec"; // Your Google Apps Script URL

      // ============================================
      // DO NOT MODIFY BELOW THIS LINE
      // ============================================

      // Form elements
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      const nameInput = document.getElementById("participantName");
      const emailInput = document.getElementById("participantEmail");
      const consentButton = document.getElementById("consentButton");
      const participateButton = document.getElementById("participateBtn");
      const errorMessage = document.getElementById("errorMessage");
      const successMessage = document.getElementById("successMessage");
      const digitalSignature = document.getElementById("digitalSignature");
      const studySection = document.getElementById("studySection");

      // Statistics tracking
      let stats = { formA: 0, formB: 0, total: 0 };
      let consentGiven = false;

      // Toggle collapsible sections
      function toggleSection(header) {
        const content = header.nextElementSibling;
        const isActive = content.classList.contains("active");

        // Close all sections
        document.querySelectorAll(".section-content").forEach((section) => {
          section.classList.remove("active");
        });
        document.querySelectorAll(".section-header").forEach((h) => {
          h.classList.remove("active");
        });

        // Open clicked section if it wasn't active
        if (!isActive) {
          content.classList.add("active");
          header.classList.add("active");
        }
      }

      // Check if consent form is complete
      function checkConsentCompletion() {
        const allChecked = Array.from(checkboxes).every(
          (checkbox) => checkbox.checked
        );
        const nameCompleted = nameInput.value.trim().length > 0;
        const emailCompleted =
          emailInput.value.trim().length > 0 && emailInput.validity.valid;

        const formComplete = allChecked && nameCompleted && emailCompleted;
        consentButton.disabled = !formComplete;

        // Update digital signature preview
        if (nameCompleted && emailCompleted) {
          const now = new Date();
          digitalSignature.innerHTML = `
                    <strong>${nameInput.value.trim()}</strong><br>
                    ${emailInput.value.trim()}<br>
                    <em>Signed on ${now.toLocaleDateString()} at ${now.toLocaleTimeString()}</em>
                `;
          digitalSignature.style.color = "#374151";
          digitalSignature.style.fontStyle = "normal";
        } else {
          digitalSignature.innerHTML =
            "Digital signature will appear here when form is completed";
          digitalSignature.style.color = "#6b7280";
          digitalSignature.style.fontStyle = "italic";
        }

        // Hide error message if form becomes complete
        if (formComplete) {
          errorMessage.style.display = "none";
        }

        // Update progress
        updateProgress();
      }

      // Update progress indicator
      function updateProgress() {
        const step1 = document.getElementById("step1");
        const step2 = document.getElementById("step2");
        const step3 = document.getElementById("step3");
        const line1 = document.getElementById("line1");
        const line2 = document.getElementById("line2");

        // Step 1: Reading information (always completed when page loads)
        step1.classList.add("completed");
        step1.classList.remove("active");

        // Step 2: Consent
        if (consentGiven) {
          step2.classList.add("completed");
          step2.classList.remove("active");
          line1.classList.add("completed");

          // Step 3: Study participation
          step3.classList.add("active");
          step3.classList.remove("completed");
          line2.classList.add("completed");
        } else {
          step2.classList.add("active");
          step2.classList.remove("completed");
          line1.classList.remove("completed");

          step3.classList.remove("active", "completed");
          line2.classList.remove("completed");
        }
      }

      // Record consent
      function recordConsent() {
        // Final validation
        if (consentButton.disabled) {
          errorMessage.style.display = "block";
          errorMessage.scrollIntoView({ behavior: "smooth" });
          return;
        }

        // Prepare consent data
        const consentData = {
          name: nameInput.value.trim(),
          email: emailInput.value.trim(),
          timestamp: new Date().toISOString(),
          ipAddress: "Will be recorded server-side if needed",
          userAgent: navigator.userAgent,
          studyAssignment: "Will be determined by randomizer",
        };

        // Show processing state
        consentButton.disabled = true;
        consentButton.textContent = "⏳ Recording Consent...";

        // Send to Google Sheets (if configured)
        if (
          googleSheetsUrl &&
          googleSheetsUrl !==
            "https://script.google.com/macros/s/AKfycbzxEQMnnXERy-59MmPeGBz-W8-d1lnuRTB-rfct5-fEbZjPL8H9JB170VNY4KYozGEsCw/execYOUR_GOOGLE_APPS_SCRIPT_URL_HERE"
        ) {
          fetch(googleSheetsUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(consentData),
          })
            .then((response) => response.json())
            .then((result) => {
              console.log("Consent recorded:", result);
              completeConsent();
            })
            .catch((error) => {
              console.error("Error recording consent:", error);
              completeConsent(); // Still proceed even if recording fails
            });
        } else {
          console.log(
            "Google Sheets not configured, consent data:",
            consentData
          );
          completeConsent();
        }
      }

      // Complete consent process
      function completeConsent() {
        consentGiven = true;
        consentButton.textContent = "✅ Consent Recorded";
        successMessage.style.display = "block";

        // Enable study section
        studySection.classList.add("enabled");
        participateButton.disabled = false;

        // Update progress
        updateProgress();

        // Scroll to study section
        setTimeout(() => {
          studySection.scrollIntoView({ behavior: "smooth" });
        }, 500);
      }

      // Random redirect to study
      function randomRedirect() {
        if (!consentGiven) {
          alert("Please complete the consent process first!");
          return;
        }

        // Check if URLs are still placeholder values
        if (
          !formA ||
          !formB ||
          formA === "https://google.com" ||
          formB === "https://bing.com"
        ) {
          alert(
            "Study URLs not yet configured. Please contact the research team."
          );
          return;
        }

        // Random assignment (50/50 chance)
        const isFormA = Math.random() < 0.5;
        const targetUrl = isFormA ? formA : formB;

        // Update statistics
        if (isFormA) {
          stats.formA++;
        } else {
          stats.formB++;
        }
        stats.total++;

        // Log the assignment
        console.log(`Assigned to: ${isFormA ? "Condition A" : "Condition B"}`);
        console.log(`Redirecting to: ${targetUrl}`);

        // Show final step completion
        document.getElementById("step3").classList.add("completed");
        document.getElementById("step3").classList.remove("active");

        // Redirect immediately
        window.location.href = targetUrl;
      }

      // Add event listeners
      checkboxes.forEach((checkbox) => {
        checkbox.addEventListener("change", checkConsentCompletion);
      });

      nameInput.addEventListener("input", checkConsentCompletion);
      emailInput.addEventListener("input", checkConsentCompletion);

      // Initialize
      checkConsentCompletion();
      updateProgress();
    </script>
  </body>
</html>
